<!DOCTYPE html>
<html lang="en" class="dark">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Football Analytics Dashboard</title>

  <!-- Tailwind + Libraries -->
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/feather-icons/dist/feather.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script src="https://cdn.datatables.net/1.13.4/js/jquery.dataTables.min.js"></script>
  <link rel="stylesheet" href="https://cdn.datatables.net/1.13.4/css/jquery.dataTables.min.css" />
</head>
<body class="bg-gray-50 dark:bg-gray-900 text-gray-900 dark:text-gray-100">

  <!-- Navigation -->
  <nav class="bg-white dark:bg-gray-800 shadow-sm border-b border-gray-200 dark:border-gray-700 p-4">
    <div class="flex space-x-6">
      <button onclick="showSection('overview')" class="nav-btn px-4 py-2 rounded-lg bg-blue-100 dark:bg-blue-900 text-blue-800 dark:text-blue-200" data-section="overview">
        Overview
      </button>
      <button onclick="showSection('trends')" class="nav-btn px-4 py-2 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700" data-section="trends">
        Time Series
      </button>
      <button onclick="showSection('players')" class="nav-btn px-4 py-2 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700" data-section="players">
        Player Stats
      </button>
    </div>
  </nav>

  <!-- Overview Section -->
  <section id="overview-section" class="section-content">
    <!-- KPI Cards -->
    <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8 p-6">
      <div class="bg-white dark:bg-gray-800 rounded-xl shadow-md p-6">
        <p class="text-gray-500 dark:text-gray-400 text-sm">Total Players</p>
        <h2 id="total-players" class="text-3xl font-bold">0</h2>
      </div>
      <div class="bg-white dark:bg-gray-800 rounded-xl shadow-md p-6">
        <p class="text-gray-500 dark:text-gray-400 text-sm">Top Scorer</p>
        <h2 id="top-scorer-name" class="text-xl font-bold">Loading...</h2>
        <p id="top-scorer-pts" class="text-sm">-- FPts</p>
      </div>
      <div class="bg-white dark:bg-gray-800 rounded-xl shadow-md p-6">
        <p class="text-gray-500 dark:text-gray-400 text-sm">Avg. Points</p>
        <h2 id="avg-points" class="text-3xl font-bold">0</h2>
      </div>
      <div class="bg-white dark:bg-gray-800 rounded-xl shadow-md p-6">
        <p class="text-gray-500 dark:text-gray-400 text-sm">Current Gameweek</p>
        <h2 id="current-gameweek" class="text-3xl font-bold">5</h2>
      </div>
    </div>

    <!-- League Standings -->
    <div class="p-6">
      <div class="bg-white dark:bg-gray-800 rounded-xl shadow-md p-6">
        <h3 class="text-xl font-bold mb-4">League Standings</h3>
        <div class="overflow-x-auto">
          <table id="standings-table" class="w-full text-sm">
            <thead>
              <tr class="border-b border-gray-200 dark:border-gray-700">
                <th class="text-left py-2">Pos</th>
                <th class="text-left py-2">Team</th>
                <th class="text-left py-2">W</th>
                <th class="text-left py-2">L</th>
                <th class="text-left py-2">Points For</th>
                <th class="text-left py-2">Points Against</th>
                <th class="text-left py-2">Avg Score</th>
              </tr>
            </thead>
            <tbody id="standings-body">
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </section>

  <!-- Time Series Section -->
  <section id="trends-section" class="section-content hidden">
    <div class="p-6">
      <!-- Team Selector -->
      <div class="mb-6">
        <div class="bg-white dark:bg-gray-800 rounded-xl shadow-md p-6">
          <h3 class="text-lg font-semibold mb-4">Select Teams to Compare</h3>
          <div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-3">
            <div id="team-checkboxes" class="contents">
              <!-- Team checkboxes will be populated by JavaScript -->
            </div>
          </div>
        </div>
      </div>

      <!-- Charts -->
      <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6">
        <!-- Score Trends -->
        <div class="bg-white dark:bg-gray-800 rounded-xl shadow-md p-6">
          <h3 class="text-lg font-semibold mb-4">Score Trends by Gameweek</h3>
          <canvas id="score-trends-chart" width="400" height="300"></canvas>
        </div>

        <!-- Win/Loss Chart -->
        <div class="bg-white dark:bg-gray-800 rounded-xl shadow-md p-6">
          <h3 class="text-lg font-semibold mb-4">Win Rate by Team</h3>
          <canvas id="win-rate-chart" width="400" height="300"></canvas>
        </div>
      </div>

      <!-- Performance Matrix -->
      <div class="bg-white dark:bg-gray-800 rounded-xl shadow-md p-6">
        <h3 class="text-lg font-semibold mb-4">Team Performance Matrix</h3>
        <canvas id="performance-matrix-chart" width="800" height="400"></canvas>
      </div>
    </div>
  </section>

  <!-- Player Stats Section -->
  <section id="players-section" class="section-content hidden">
    <div class="p-6">
      <div class="bg-white dark:bg-gray-800 rounded-xl shadow-md p-6">
        <h3 class="text-xl font-bold mb-4">Player Statistics</h3>
        <table id="players-table" class="display stripe hover w-full text-sm"></table>
      </div>
    </div>
  </section>

  <script>
    // Global variables
    let matchData = [];
    let playerData = [];
    let charts = {};
    
    // Embedded match records data
    const matchRecordsCSV = `Gameweek,Start_Date,End_Date,Team,Score,Opponent,Opp_Score,Result
1,Fri Aug 15 2025,Thu Aug 21 2025,FPL Loyalists,116.5,"Me,Myself,Ndiaye",107.75,W
1,Fri Aug 15 2025,Thu Aug 21 2025,"Me,Myself,Ndiaye",107.75,FPL Loyalists,116.5,L
1,Fri Aug 15 2025,Thu Aug 21 2025,Book Ake,121.5,ESRs EDL for FPL,91.83,W
1,Fri Aug 15 2025,Thu Aug 21 2025,ESRs EDL for FPL,91.83,Book Ake,121.5,L
1,Fri Aug 15 2025,Thu Aug 21 2025,Texas Chainshaw Massacre,112.67,Bryan MBeumboclaat,82.3,W
1,Fri Aug 15 2025,Thu Aug 21 2025,Bryan MBeumboclaat,82.3,Texas Chainshaw Massacre,112.67,L
1,Fri Aug 15 2025,Thu Aug 21 2025,I'm a Baleba,180.72,Infantino Milan,116.36,W
1,Fri Aug 15 2025,Thu Aug 21 2025,Infantino Milan,116.36,I'm a Baleba,180.72,L
1,Fri Aug 15 2025,Thu Aug 21 2025,Haile Senesi,94.22,*League Average*,113.106,L
1,Fri Aug 15 2025,Thu Aug 21 2025,*League Average*,113.106,Haile Senesi,94.22,W
1,Fri Aug 15 2025,Thu Aug 21 2025,Chicken Tikka MoSalah,138.88,Iwobi Wan-Kenobi,127.84,W
1,Fri Aug 15 2025,Thu Aug 21 2025,Iwobi Wan-Kenobi,127.84,Chicken Tikka MoSalah,138.88,L
1,Fri Aug 15 2025,Thu Aug 21 2025,Ugarte roll with it,112.68,Ekitiki-taka,67.13,W
1,Fri Aug 15 2025,Thu Aug 21 2025,Ekitiki-taka,67.13,Ugarte roll with it,112.68,L
2,Fri Aug 22 2025,Thu Aug 28 2025,"Me,Myself,Ndiaye",114.62,Book Ake,128.65,L
2,Fri Aug 22 2025,Thu Aug 28 2025,Book Ake,128.65,"Me,Myself,Ndiaye",114.62,W
2,Fri Aug 22 2025,Thu Aug 28 2025,FPL Loyalists,95.03,Texas Chainshaw Massacre,103.64,L
2,Fri Aug 22 2025,Thu Aug 28 2025,Texas Chainshaw Massacre,103.64,FPL Loyalists,95.03,W
2,Fri Aug 22 2025,Thu Aug 28 2025,ESRs EDL for FPL,127.51,I'm a Baleba,111.67,W
2,Fri Aug 22 2025,Thu Aug 28 2025,I'm a Baleba,111.67,ESRs EDL for FPL,127.51,L
2,Fri Aug 22 2025,Thu Aug 28 2025,Bryan MBeumboclaat,93.97,Haile Senesi,107.67,L
2,Fri Aug 22 2025,Thu Aug 28 2025,Haile Senesi,107.67,Bryan MBeumboclaat,93.97,W
2,Fri Aug 22 2025,Thu Aug 28 2025,Infantino Milan,128.77,Chicken Tikka MoSalah,109.73,W
2,Fri Aug 22 2025,Thu Aug 28 2025,Chicken Tikka MoSalah,109.73,Infantino Milan,128.77,L
2,Fri Aug 22 2025,Thu Aug 28 2025,*League Average*,106.528,Ugarte roll with it,105.66,W
2,Fri Aug 22 2025,Thu Aug 28 2025,Ugarte roll with it,105.66,*League Average*,106.528,L
2,Fri Aug 22 2025,Thu Aug 28 2025,Iwobi Wan-Kenobi,61.35,Ekitiki-taka,96.6,L
2,Fri Aug 22 2025,Thu Aug 28 2025,Ekitiki-taka,96.6,Iwobi Wan-Kenobi,61.35,W
3,Fri Aug 29 2025,Thu Sep 11 2025,Texas Chainshaw Massacre,112.55,"Me,Myself,Ndiaye",84.2,W
3,Fri Aug 29 2025,Thu Sep 11 2025,"Me,Myself,Ndiaye",84.2,Texas Chainshaw Massacre,112.55,L
3,Fri Aug 29 2025,Thu Sep 11 2025,I'm a Baleba,60.32,Book Ake,115.18,L
3,Fri Aug 29 2025,Thu Sep 11 2025,Book Ake,115.18,I'm a Baleba,60.32,W
3,Fri Aug 29 2025,Thu Sep 11 2025,Haile Senesi,142.27,FPL Loyalists,72.6,W
3,Fri Aug 29 2025,Thu Sep 11 2025,FPL Loyalists,72.6,Haile Senesi,142.27,L
3,Fri Aug 29 2025,Thu Sep 11 2025,Chicken Tikka MoSalah,121.08,ESRs EDL for FPL,110.67,W
3,Fri Aug 29 2025,Thu Sep 11 2025,ESRs EDL for FPL,110.67,Chicken Tikka MoSalah,121.08,L
3,Fri Aug 29 2025,Thu Sep 11 2025,Ugarte roll with it,109.79,Bryan MBeumboclaat,93.48,W
3,Fri Aug 29 2025,Thu Sep 11 2025,Bryan MBeumboclaat,93.48,Ugarte roll with it,109.79,L
3,Fri Aug 29 2025,Thu Sep 11 2025,Ekitiki-taka,74.9,Infantino Milan,94.55,L
3,Fri Aug 29 2025,Thu Sep 11 2025,Infantino Milan,94.55,Ekitiki-taka,74.9,W
3,Fri Aug 29 2025,Thu Sep 11 2025,Iwobi Wan-Kenobi,106.57,*League Average*,99.858,W
3,Fri Aug 29 2025,Thu Sep 11 2025,*League Average*,99.858,Iwobi Wan-Kenobi,106.57,L
4,Fri Sep 12 2025,Thu Sep 18 2025,"Me,Myself,Ndiaye",103.58,I'm a Baleba,126.16,L
4,Fri Sep 12 2025,Thu Sep 18 2025,I'm a Baleba,126.16,"Me,Myself,Ndiaye",103.58,W
4,Fri Sep 12 2025,Thu Sep 18 2025,Texas Chainshaw Massacre,129.53,Haile Senesi,100.52,W
4,Fri Sep 12 2025,Thu Sep 18 2025,Haile Senesi,100.52,Texas Chainshaw Massacre,129.53,L
4,Fri Sep 12 2025,Thu Sep 18 2025,Book Ake,131.98,Chicken Tikka MoSalah,103.84,W
4,Fri Sep 12 2025,Thu Sep 18 2025,Chicken Tikka MoSalah,103.84,Book Ake,131.98,L
4,Fri Sep 12 2025,Thu Sep 18 2025,FPL Loyalists,111.5,Ugarte roll with it,109.75,W
4,Fri Sep 12 2025,Thu Sep 18 2025,Ugarte roll with it,109.75,FPL Loyalists,111.5,L
4,Fri Sep 12 2025,Thu Sep 18 2025,ESRs EDL for FPL,113.62,Ekitiki-taka,80.53,W
4,Fri Sep 12 2025,Thu Sep 18 2025,Ekitiki-taka,80.53,ESRs EDL for FPL,113.62,L
4,Fri Sep 12 2025,Thu Sep 18 2025,Bryan MBeumboclaat,102.73,Iwobi Wan-Kenobi,110.27,L
4,Fri Sep 12 2025,Thu Sep 18 2025,Iwobi Wan-Kenobi,110.27,Bryan MBeumboclaat,102.73,W
4,Fri Sep 12 2025,Thu Sep 18 2025,Infantino Milan,135.82,*League Average*,112.295,W
4,Fri Sep 12 2025,Thu Sep 18 2025,*League Average*,112.295,Infantino Milan,135.82,L
5,Fri Sep 19 2025,Thu Sep 25 2025,Haile Senesi,90.57,"Me,Myself,Ndiaye",80.53,W
5,Fri Sep 19 2025,Thu Sep 25 2025,"Me,Myself,Ndiaye",80.53,Haile Senesi,90.57,L
5,Fri Sep 19 2025,Thu Sep 25 2025,Chicken Tikka MoSalah,134.6,I'm a Baleba,130.82,W
5,Fri Sep 19 2025,Thu Sep 25 2025,I'm a Baleba,130.82,Chicken Tikka MoSalah,134.6,L
5,Fri Sep 19 2025,Thu Sep 25 2025,Ugarte roll with it,46.52,Texas Chainshaw Massacre,81.5,L
5,Fri Sep 19 2025,Thu Sep 25 2025,Texas Chainshaw Massacre,81.5,Ugarte roll with it,46.52,W
5,Fri Sep 19 2025,Thu Sep 25 2025,Ekitiki-taka,100.58,Book Ake,105.31,L
5,Fri Sep 19 2025,Thu Sep 25 2025,Book Ake,105.31,Ekitiki-taka,100.58,W
5,Fri Sep 19 2025,Thu Sep 25 2025,Iwobi Wan-Kenobi,147.7,FPL Loyalists,83.39,W
5,Fri Sep 19 2025,Thu Sep 25 2025,FPL Loyalists,83.39,Iwobi Wan-Kenobi,147.7,L
5,Fri Sep 19 2025,Thu Sep 25 2025,*League Average*,100.678,ESRs EDL for FPL,99.67,W
5,Fri Sep 19 2025,Thu Sep 25 2025,ESRs EDL for FPL,99.67,*League Average*,100.678,L
5,Fri Sep 19 2025,Thu Sep 25 2025,Infantino Milan,107.4,Bryan MBeumboclaat,100.23,W
5,Fri Sep 19 2025,Thu Sep 25 2025,Bryan MBeumboclaat,100.23,Infantino Milan,107.4,L`;

    // Navigation functionality
    function showSection(sectionName) {
      // Hide all sections
      document.querySelectorAll('.section-content').forEach(section => {
        section.classList.add('hidden');
      });
      
      // Show selected section
      document.getElementById(sectionName + '-section').classList.remove('hidden');
      
      // Update navigation buttons
      document.querySelectorAll('.nav-btn').forEach(btn => {
        btn.classList.remove('bg-blue-100', 'dark:bg-blue-900', 'text-blue-800', 'dark:text-blue-200');
        btn.classList.add('hover:bg-gray-100', 'dark:hover:bg-gray-700');
      });
      
      const activeBtn = document.querySelector(`[data-section="${sectionName}"]`);
      activeBtn.classList.add('bg-blue-100', 'dark:bg-blue-900', 'text-blue-800', 'dark:text-blue-200');
      activeBtn.classList.remove('hover:bg-gray-100', 'dark:hover:bg-gray-700');
      
      // Initialize charts when showing trends section
      if (sectionName === 'trends') {
        setTimeout(initializeCharts, 100);
      }
    }

    // Parse match records data
    function parseMatchData() {
      const parsedData = Papa.parse(matchRecordsCSV, {
        header: true,
        skipEmptyLines: true
      }).data;
      
      matchData = parsedData.filter(row => row.Team !== '*League Average*');
      return matchData;
    }

    // Calculate league standings
    function calculateStandings() {
      const teamStats = {};
      
      matchData.forEach(match => {
        const team = match.Team;
        if (!teamStats[team]) {
          teamStats[team] = {
            wins: 0,
            losses: 0,
            pointsFor: 0,
            pointsAgainst: 0,
            games: 0
          };
        }
        
        teamStats[team].games++;
        teamStats[team].pointsFor += parseFloat(match.Score);
        teamStats[team].pointsAgainst += parseFloat(match.Opp_Score);
        
        if (match.Result === 'W') {
          teamStats[team].wins++;
        } else {
          teamStats[team].losses++;
        }
      });
      
      // Convert to array and sort by wins, then by average score
      const standings = Object.entries(teamStats).map(([team, stats]) => ({
        team,
        wins: stats.wins,
        losses: stats.losses,
        pointsFor: stats.pointsFor.toFixed(1),
        pointsAgainst: stats.pointsAgainst.toFixed(1),
        avgScore: (stats.pointsFor / stats.games).toFixed(1)
      })).sort((a, b) => {
        if (b.wins !== a.wins) return b.wins - a.wins;
        return parseFloat(b.avgScore) - parseFloat(a.avgScore);
      });
      
      return standings;
    }

    // Render standings table
    function renderStandings() {
      const standings = calculateStandings();
      const tbody = document.getElementById('standings-body');
      tbody.innerHTML = '';
      
      standings.forEach((team, index) => {
        const row = document.createElement('tr');
        row.className = 'border-b border-gray-100 dark:border-gray-700 hover:bg-gray-50 dark:hover:bg-gray-700';
        row.innerHTML = `
          <td class="py-2 font-semibold">${index + 1}</td>
          <td class="py-2">${team.team}</td>
          <td class="py-2 text-green-600 font-semibold">${team.wins}</td>
          <td class="py-2 text-red-600 font-semibold">${team.losses}</td>
          <td class="py-2">${team.pointsFor}</td>
          <td class="py-2">${team.pointsAgainst}</td>
          <td class="py-2 font-semibold">${team.avgScore}</td>
        `;
        tbody.appendChild(row);
      });
    }

    // Create team checkboxes
    function createTeamCheckboxes() {
      const teams = [...new Set(matchData.map(match => match.Team))];
      const container = document.getElementById('team-checkboxes');
      container.innerHTML = '';
      
      teams.slice(0, 5).forEach((team, index) => {
        const div = document.createElement('div');
        div.className = 'flex items-center space-x-2';
        div.innerHTML = `
          <input type="checkbox" id="team-${index}" value="${team}" ${index < 3 ? 'checked' : ''} 
                 onchange="updateCharts()" class="rounded text-blue-600">
          <label for="team-${index}" class="text-sm truncate">${team}</label>
        `;
        container.appendChild(div);
      });
    }

    // Initialize charts
    function initializeCharts() {
      if (Object.keys(charts).length === 0) {
        createScoreTrendsChart();
        createWinRateChart();
        createPerformanceMatrixChart();
        createTeamCheckboxes();
      }
      updateCharts();
    }

    // Create score trends chart
    function createScoreTrendsChart() {
      const ctx = document.getElementById('score-trends-chart').getContext('2d');
      charts.scoreeTrends = new Chart(ctx, {
        type: 'line',
        data: {
          labels: [],
          datasets: []
        },
        options: {
          responsive: true,
          plugins: {
            legend: {
              labels: { color: '#9CA3AF' }
            }
          },
          scales: {
            x: {
              ticks: { color: '#9CA3AF' },
              grid: { color: '#374151' }
            },
            y: {
              ticks: { color: '#9CA3AF' },
              grid: { color: '#374151' }
            }
          }
        }
      });
    }

    // Create win rate chart
    function createWinRateChart() {
      const ctx = document.getElementById('win-rate-chart').getContext('2d');
      charts.winRate = new Chart(ctx, {
        type: 'doughnut',
        data: {
          labels: [],
          datasets: [{
            data: [],
            backgroundColor: [
              '#3B82F6', '#EF4444', '#10B981', '#F59E0B', '#8B5CF6',
              '#F97316', '#06B6D4', '#84CC16', '#EC4899', '#6B7280'
            ]
          }]
        },
        options: {
          responsive: true,
          plugins: {
            legend: {
              labels: { color: '#9CA3AF' }
            }
          }
        }
      });
    }

    // Create performance matrix chart
    function createPerformanceMatrixChart() {
      const ctx = document.getElementById('performance-matrix-chart').getContext('2d');
      charts.performanceMatrix = new Chart(ctx, {
        type: 'scatter',
        data: {
          datasets: []
        },
        options: {
          responsive: true,
          plugins: {
            legend: {
              labels: { color: '#9CA3AF' }
            }
          },
          scales: {
            x: {
              title: {
                display: true,
                text: 'Average Score',
                color: '#9CA3AF'
              },
              ticks: { color: '#9CA3AF' },
              grid: { color: '#374151' }
            },
            y: {
              title: {
                display: true,
                text: 'Win Rate (%)',
                color: '#9CA3AF'
              },
              ticks: { color: '#9CA3AF' },
              grid: { color: '#374151' }
            }
          }
        }
      });
    }

    // Update charts based on selected teams
    function updateCharts() {
      const selectedTeams = Array.from(document.querySelectorAll('#team-checkboxes input[type="checkbox"]:checked'))
        .map(cb => cb.value);
      
      updateScoreTrendsChart(selectedTeams);
      updateWinRateChart(selectedTeams);
      updatePerformanceMatrixChart(selectedTeams);
    }

    // Update score trends chart
    function updateScoreTrendsChart(selectedTeams) {
      const gameweeks = [...new Set(matchData.map(match => match.Gameweek))].sort();
      const datasets = [];
      const colors = ['#3B82F6', '#EF4444', '#10B981', '#F59E0B', '#8B5CF6', '#F97316', '#06B6D4'];
      
      selectedTeams.forEach((team, index) => {
        const teamData = gameweeks.map(gw => {
          const match = matchData.find(m => m.Team === team && m.Gameweek === gw);
          return match ? parseFloat(match.Score) : null;
        });
        
        datasets.push({
          label: team,
          data: teamData,
          borderColor: colors[index % colors.length],
          backgroundColor: colors[index % colors.length] + '20',
          tension: 0.4
        });
      });
      
      charts.scoreeTrends.data.labels = gameweeks.map(gw => `GW${gw}`);
      charts.scoreeTrends.data.datasets = datasets;
      charts.scoreeTrends.update();
    }

    // Update win rate chart
    function updateWinRateChart(selectedTeams) {
      const winRates = selectedTeams.map(team => {
        const teamMatches = matchData.filter(match => match.Team === team);
        const wins = teamMatches.filter(match => match.Result === 'W').length;
        return ((wins / teamMatches.length) * 100).toFixed(1);
      });
      
      charts.winRate.data.labels = selectedTeams;
      charts.winRate.data.datasets[0].data = winRates;
      charts.winRate.update();
    }

    // Update performance matrix chart
    function updatePerformanceMatrixChart(selectedTeams) {
      const datasets = selectedTeams.map((team, index) => {
        const teamMatches = matchData.filter(match => match.Team === team);
        const avgScore = teamMatches.reduce((sum, match) => sum + parseFloat(match.Score), 0) / teamMatches.length;
        const wins = teamMatches.filter(match => match.Result === 'W').length;
        const winRate = (wins / teamMatches.length) * 100;
        
        return {
          label: team,
          data: [{ x: avgScore, y: winRate }],
          backgroundColor: ['#3B82F6', '#EF4444', '#10B981', '#F59E0B', '#8B5CF6'][index % 5],
          pointRadius: 8
        };
      });
      
      charts.performanceMatrix.data.datasets = datasets;
      charts.performanceMatrix.update();
    }

    // Initialize everything when page loads
    document.addEventListener("DOMContentLoaded", () => {
      // Parse match data
      parseMatchData();
      
      // Load and process player data from ref.csv
      Papa.parse("ref.csv", {
        download: true,
        header: true,
        skipEmptyLines: true,
        complete: function(results) {
          playerData = results.data;

          // Update KPIs
          document.getElementById("total-players").innerText = playerData.length;

          // Top scorer
          let topScorer = playerData.reduce((a, b) =>
            parseFloat(a["FPts"] || 0) > parseFloat(b["FPts"] || 0) ? a : b
          );
          document.getElementById("top-scorer-name").innerText = topScorer["Player"];
          document.getElementById("top-scorer-pts").innerText = `${topScorer["FPts"]} FPts`;

          // Average FPts
          let avgPts = (
            playerData.reduce((sum, p) => sum + parseFloat(p["FPts"] || 0), 0) / playerData.length
          ).toFixed(1);
          document.getElementById("avg-points").innerText = avgPts;

          // Initialize DataTable for players
          const tableData = playerData.map(p => [
            p["Player"],
            p["Team"],
            p["Position"],
            p["RkOv"],
            p["Status"],
            p["Opponent"],
            p["FPts"],
            p["FP/G"],
            p["Ros"],
            p["+/-"]
          ]);

          $('#players-table').DataTable({
            data: tableData,
            columns: [
              { title: "Player" },
              { title: "Team" },
              { title: "Position" },
              { title: "RkOv" },
              { title: "Status" },
              { title: "Opponent" },
              { title: "FPts" },
              { title: "FP/G" },
              { title: "Ros" },
              { title: "+/-" }
            ],
            pageLength: 15,
            order: [[6, 'desc']], // Sort by FPts descending
            responsive: true,
            dom: 'Bfrtip',
            language: {
              search: "Search players:",
              lengthMenu: "Show _MENU_ players",
              info: "Showing _START_ to _END_ of _TOTAL_ players"
            }
          });
        },
        error: function(error) {
          console.warn("Could not load ref.csv, using sample data");
          // Fallback if ref.csv is not available
          document.getElementById("total-players").innerText = "N/A";
          document.getElementById("top-scorer-name").innerText = "Data not available";
          document.getElementById("top-scorer-pts").innerText = "-- FPts";
          document.getElementById("avg-points").innerText = "N/A";
        }
      });

      // Render league standings
      renderStandings();

      // Initialize Feather icons
      feather.replace();
    });
  </script>

  <style>
    /* Custom styles for better dark mode support */
    .dataTables_wrapper .dataTables_length,
    .dataTables_wrapper .dataTables_filter,
    .dataTables_wrapper .dataTables_info,
    .dataTables_wrapper .dataTables_paginate {
      color: #9CA3AF;
    }
    
    .dataTables_wrapper .dataTables_paginate .paginate_button {
      color: #9CA3AF !important;
    }
    
    .dataTables_wrapper .dataTables_paginate .paginate_button:hover {
      background: #374151 !important;
      border-color: #374151 !important;
    }
    
    .dataTables_wrapper table.dataTable tbody tr {
      background-color: transparent;
    }
    
    .dataTables_wrapper table.dataTable tbody tr:hover {
      background-color: rgba(55, 65, 81, 0.5) !important;
    }

    /* Smooth transitions for section switching */
    .section-content {
      transition: opacity 0.3s ease-in-out;
    }
    
    .section-content.hidden {
      opacity: 0;
      pointer-events: none;
    }
    
    /* Custom checkbox styling */
    input[type="checkbox"] {
      accent-color: #3B82F6;
    }
    
    /* Chart container responsive adjustments */
    canvas {
      max-height: 300px !important;
    }
    
    @media (max-width: 768px) {
      .grid-cols-2 {
        grid-template-columns: repeat(1, minmax(0, 1fr));
      }
      
      canvas {
        max-height: 250px !important;
      }
    }
  </style>
</body>
</html>
